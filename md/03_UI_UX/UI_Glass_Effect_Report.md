# 유리 효과(Glass Refraction) 아티팩트 및 흔들림 현상 분석 보고서

## 1. 개요
사용자께서 제보해주신 두 가지 주요 시각적 문제에 대한 원인 분석 및 해결 방안 보고서입니다.

1. **테두리 아티팩트**: 약 10px 두께의 베어먹은 사과 모양(안쪽으로 파인 형태)의 테두리가 보임.
2. **헤더 뒤 울렁거림**: 헤더 영역 뒤쪽 배경이 물결치듯 흔들림.

---

## 2. 원인 분석

### 2.1. 테두리 아티팩트 (베어먹은 사과 모양)
- **원인**: 셰이더 코드(`GlassRefraction.fx`) 내부에 구현된 **가장자리 페이드(Edge Fade)** 로직 때문입니다.
- **상세 분석**:
  ```hlsl
  // GlassRefraction.fx (Line 102-105)
  float edgeAlpha = smoothstep_custom(0.0, 0.02, uvG.x) *
                    smoothstep_custom(1.0, 0.98, uvG.x) *
                    smoothstep_custom(0.0, 0.02, uvG.y) *
                    smoothstep_custom(1.0, 0.98, uvG.y);
  ```
  - 위 코드는 텍스처 좌표(UV) 끝부분 0.0~0.02 (약 2%) 영역을 강제로 투명하게 만듭니다.
  - UI 크기가 약 500px~1000px일 때 2%는 약 **10px~20px**에 해당하며, 이는 사용자께서 관찰하신 두께와 일치합니다.
  - `smoothstep` 함수가 X축과 Y축에 각각 적용되고 곱해지면서(`*`), 모서리 부분에서 두 페이드가 겹쳐 **안쪽으로 둥글게 파인 형태(Concave/베어먹은 사과)**의 투명도 마스크가 생성됩니다.

### 2.2. 헤더 뒤 울렁거림 (Waviness)
- **원인**: 셰이더의 노이즈 텍스처 샘플링에 사용되는 **시간(Time) 변수** 때문입니다.
- **상세 분석**:
  ```hlsl
  // GlassRefraction.fx (Line 57, 62)
  float2 flow1 = float2(time * 0.05, time * 0.02);
  ...
  float2 flow2 = float2(-time * 0.03, time * 0.06);
  ```
  - `time` 변수가 계속 증가함에 따라 노이즈 텍스처를 이동(Flow)시킵니다.
  - 이로 인해 굴절 패턴이 계속 움직여서, 정지된 유리창이 아니라 **흐르는 물이나 아지랑이** 같은 효과를 냅니다.

---

## 3. 해결 방안 (제안)

이 문제를 수정하기 위해 셰이더 코드(`GlassRefraction.fx`)를 다음과 같이 수정할 것을 제안합니다.

### 3.1. 테두리 아티팩트 제거
가장자리 페이드 로직을 제거하거나, 범위를 극도로 줄입니다. WPF의 `Border` 컨트롤이 이미 `CornerRadius`와 `ClipToBounds`를 처리하므로, 셰이더에서 추가로 페이드를 줄 필요가 없습니다.

**수정안**:
```hlsl
// 기존: edgeAlpha 계산 로직
// 수정: edgeAlpha를 무조건 1.0으로 설정하거나 해당 코드 블록 제거
float edgeAlpha = 1.0; 
```

### 3.2. 울렁거림 제거 (정적 유리 효과)
시간(`time`) 변수의 영향을 제거하여 노이즈 패턴을 고정합니다.

**수정안**:
```hlsl
// 기존: time을 곱해 계속 이동
// 수정: time 대신 0.0 사용 (고정된 굴절)
float2 flow1 = float2(0.0, 0.0);
float2 flow2 = float2(0.0, 0.0);
```

이 수정을 적용하면 **깨끗한 외곽선**과 **흔들리지 않는 고정된 유리 질감**을 얻을 수 있습니다.
사용자의 승인이 있으면 즉시 적용하겠습니다.
